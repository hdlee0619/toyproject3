<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="utf-8" />
   <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"></script>
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css"
      integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w=="
      crossorigin="anonymous" referrerpolicy="no-referrer" />
   <title>TIL 순위</title>

   <link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap" rel="stylesheet" />

   <style>
      * {
         font-family: "Gowun Dodum", sans-serif;
      }




      .mytitle {
         margin-left: 30%;
         padding-top: 20px;
         height: 100px;
      }

      .mypost {
         width: 95%;
         max-width: 500px;
         margin: 20px auto 0px auto;
         padding: 20px;
         box-shadow: 0px 0px 3px 0px gray;
      }

      th {
         width: 20px;
      }

      td {
         vertical-align: center;
      }

      .side_menu {
         position: fixed;
         top: 150px;
         left: 50px;

         border-radius: 30px;
         display: flex;
         flex-direction: column;
         width: 4rem;
         align-content: center;
         padding: 0.5rem;
         text-align: center;
         z-index: 5;
         background: #333;
          opacity: 0;


         transition: 0.3s ease-in-out;
      }

      .side_menu div {
         pointer-events: revert;
         width: 100%;
         padding: 10px 10px;
         border-radius: 25px;
         margin-bottom: 10px;
         background: #868e96;
      }

      .side_menu div i {
         font-size: 1.3rem;
         color: white;
      }

      .side_menu div i:hover {
         transform: scale(1.4);
         transition: all 0.2s ease;
      }


  header{
        width: 100%;
        height: 340px;

        background-image: linear-gradient(0deg, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('https://i.pinimg.com/564x/65/49/40/654940cf7589fb38166ecb1c8114a2e9.jpg');
        background-position: center;
        background-size: cover;

        color: white;

        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;

        }

        .hof{
            width: 90%;
            height: 1000px;
            margin: 0 auto;
            background: #f1f3f5;

        }

        .hof-1{
            width: 35%;
            height: 50%;
            margin: 0 auto;
            margin-bottom: 20px;
            margin-top: 10px;
            text-align: center;
            padding-top: 20px;

        }



        .rank{
            width: 100%;
            height: 400px;
            border-radius: 10px;
              box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
            transition: all 0.3s cubic-bezier(.25, .8, .25, 1);
             border-radius: 15px;
        }
        .rank:hover{
             box-shadow: 0 14px 28px rgba(0, 0, 0, 0.25), 0 10px 10px rgba(0, 0, 0, 0.22);
        }



        .rank img{
            width: 100%;
            height: 200px;
            margin: 0 auto;
            border-radius: 15px;
        }
        .rank h4{
            padding-top: 15px;
            width: 100%;
          height: 25%;
        }






        /*  2,3 등 나누기*/
        .hof-23{
            width: 95%;
            height: 50%;

            margin: 0 auto;
            display: flex;
        }
        /*  2,3 등 각각 나누기*/
        .hof-23 .rank1{
            width: 35%;
            height: 400px;
            margin: 0 auto;

            text-align: center;
             background: #e9ecef;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
            transition: all 0.3s cubic-bezier(.25, .8, .25, 1);
            text-align: center;
             border-radius: 15px;
        }
   .hof-23 .rank1:hover {
            box-shadow: 0 14px 28px rgba(0, 0, 0, 0.25), 0 10px 10px rgba(0, 0, 0, 0.22);
        }
   /* 이미지 사이즈 */
   .hof-23 .rank1 img{
       width: 100%;
       height: 50%;
        border-radius: 15px;
   }
   /* 이미지 사이즈 */
      .hof-23 .rank1 h4{
          padding-top: 15px;
          width: 100%;
          height: 25%;
      }

#vlog_link{
            text-decoration: none;
            color: rgb(32, 37, 42);
         }

   </style>
   <script>
      $(document).ready(function () {
         listing();
      });

      function listing() {
         $.ajax({
            type: "GET",
            url: "/ranking",
            data: {},
            success: function (response) {
               let rows = response["tils"];

               let rank = Array.from(Array(rows.length), () => new Array(3));
               for (let i = 0; i < rows.length; i++) {
                  let like = rows[i]["like"];
                  let name = rows[i]["name"];
                  let address = rows[i]["vlog_url"];
                  let title = rows[i]["title"];
                  let img = rows[i]['img'];

                  rank[i] = [like, name, address, title, img];
               }

               let sortedRank = rank.sort((a, b) => {
                  if (a[0] === b[0]) {
                     return a[1] < b[1] ? -1 : a[1] > b[0] ? 1 : 0;
                  } else {
                     return b[0] - a[0];
                  }
               });

               console.log(sortedRank[0])




               // 1등 출력 
               ranking1_html = `
                     <div class="rank">
                    <img src=${sortedRank[0][4]} alt="1등이미지">
                <h4>${sortedRank[0][3]}</h4>
               <p>작성자 : ${sortedRank[0][1]}</p>
               <span>👍: ${sortedRank[0][0]}</span>
           </div>
                   `;
               $("#first").append(ranking1_html)

                //2,3 등출력
                  //2,3등 출력
                 ranking2_html = `
                     <div class="rank1">
                    <img src=${sortedRank[1][4]} alt="2등이미지">
                <h4>${sortedRank[1][3]}</h4>
               <p>작성자 : ${sortedRank[1][1]}</p>
               <span>👍: ${sortedRank[1][0]}</span>
           </div>

                 <div class="rank1">
                    <img src=${sortedRank[2][4]} alt="3등이미지">
                        <h4>${sortedRank[2][3]}</h4>
                        <p>작성자 : ${sortedRank[2][1]}</p>
                         <span>👍: ${sortedRank[2][0]}</span>
                 </div>

                   `;
               $('#second').append(ranking2_html)







               let count = 0;
               for (let i = 0; i < sortedRank.length; i++) {
                  count++;
                  let like = sortedRank[i][0];
                  let name = sortedRank[i][1];
                  let address = sortedRank[i][2];
                  let title = sortedRank[i][3];

                  let temp_html = `
                        <tr>
                            <th scope="row">${count}</th>
                            <td>${name}</td>
                            <td ><a href='${address}' id="vlog_link">${title}</a></td>
                            <td class="like">${like}</td>
                        </tr>
                        `;
                  $("#rank").append(temp_html);
               }
            },
         });
      }
       // scrollY 350 사이드메뉴바 보이게하기
          $(window).on('scroll', function(){
        if (window.scrollY > 350) {
       $('.side_menu').css('opacity', '1',);
           }else if(window.scrollY < 350) {
        $('.side_menu').css('opacity', '0');
        }
        });
   </script>
</head>

<body>
<header>
          <div class="navbar">
              <h2>🧑🏻‍💻항해99 TIL순위 보기</h2>
          </div>

      </header>


   <div class="side_menu">
      <div>
         <a href="#" onclick="location.href='/'">
            <i class="fa-solid fa-house"></i>
         </a>
      </div>
      <div> <a href="#" onclick="location.href='/post'">
            <i class="fa-solid fa-plus"></i>
         </a>
      </div>
      <div>
         <a href="#" onclick="location.href='/rank'">
            <i class="fa-solid fa-ranking-star"></i>
         </a>
      </div>
   </div>

   <div class="mytitle">
      <h1>TIL명예의전당 1등,2등,3등 표시가 됩니다!</h1>
   </div>


<!-- 1,2,3등 표시하기-->
   <div class="hof">
       <div class="hof-1" id="first">






       </div>

       <div class="hof-23" id="second">





       </div>
   </div>




   <div class="mytitle">
      <h1>TIL 순위</h1>
   </div>
   <div class="mypost" id="post-box">
      <table class="table">
         <thead>
            <tr>
               <th scope="col">#</th>
               <th scope="col">이름</th>
               <th scope="col">제목</th>
               <th scope="col">좋아요 수</th>
            </tr>
         </thead>
         <tbody id="rank"></tbody>
      </table>
   </div>
</body>

</html>